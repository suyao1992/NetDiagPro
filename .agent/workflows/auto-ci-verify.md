---
description: NetDiag Pro å¼€å‘åè‡ªåŠ¨ CI éªŒè¯æµç¨‹ (æè‡´ä¼˜åŒ–ç‰ˆ)
---

# ğŸš€ æè‡´è‡ªåŠ¨åŒ–éªŒè¯å·¥ä½œæµ v2.0

## æ ¸å¿ƒåŸåˆ™
1. **å¹¶è¡Œä¼˜å…ˆ** - èƒ½å¹¶è¡Œçš„ç»ä¸ä¸²è¡Œ
2. **å¢é‡éªŒè¯** - åªéªŒè¯æ”¹åŠ¨çš„éƒ¨åˆ†
3. **å¿«é€Ÿå¤±è´¥** - å°½æ—©å‘ç°é—®é¢˜
4. **è‡ªæ„ˆç³»ç»Ÿ** - å¸¸è§é”™è¯¯è‡ªåŠ¨ä¿®å¤

---

## é˜¶æ®µ 1: å¼€å‘å®Œæˆ â†’ é¢„æ£€æŸ¥ (< 5ç§’)

### 1.1 è¯­æ³•æ£€æŸ¥ (å†™ä»£ç æ—¶å°±å®Œæˆ)
// turbo
```powershell
# å¢é‡ç¼–è¯‘æ£€æŸ¥
cd F:\net-test\NetDiagPro.WinUI
dotnet build -p:Platform=x64 --no-restore -v q
```
- âœ… 0 é”™è¯¯æ‰ç»§ç»­
- âŒ æœ‰é”™è¯¯ç«‹å³ä¿®å¤ï¼Œä¸è¿›å…¥ä¸‹ä¸€æ­¥

### 1.2 å¿«é€Ÿé™æ€åˆ†æ
- æ£€æŸ¥æ˜¯å¦å¿˜è®° using
- æ£€æŸ¥æ˜¯å¦æœ‰æ˜æ˜¾çš„ null é—®é¢˜
- æ£€æŸ¥ XAML ç»‘å®šæ˜¯å¦æ­£ç¡®

---

## é˜¶æ®µ 2: æœ¬åœ°éªŒè¯ (å¹¶è¡Œæ‰§è¡Œ)

### 2.1 å®Œæ•´æ„å»º + æ™ºèƒ½ UI æµ‹è¯• (å¹¶è¡Œ)
// turbo
```powershell
# å¯åŠ¨æ„å»º (åå°)
$buildJob = Start-Job -ScriptBlock {
    cd F:\net-test\NetDiagPro.WinUI
    dotnet build -p:Platform=x64 2>&1
}

# åŒæ—¶å‡†å¤‡ UI æµ‹è¯•ç¯å¢ƒ
Stop-Process -Name NetDiagPro -Force -ErrorAction SilentlyContinue
Start-Sleep -Seconds 1

# ç­‰å¾…æ„å»ºå®Œæˆ
$buildResult = Receive-Job -Job $buildJob -Wait
if ($LASTEXITCODE -ne 0) { throw "Build failed" }
```

### 2.2 æ™ºèƒ½æµ‹è¯•é€‰æ‹© (åŸºäº Git diff)
// turbo
```powershell
cd F:\net-test\NetDiagPro.WinUI

# åˆ†ææ”¹åŠ¨æ–‡ä»¶
$changedFiles = git diff --name-only HEAD~1

# æ™ºèƒ½é€‰æ‹©æµ‹è¯•
$testFilter = switch -Regex ($changedFiles) {
    'SpeedTest'      { 'SpeedTestFlowTests'; break }
    'Traceroute'     { 'TracerouteFlowTests'; break }
    'Export|Dashboard|NetworkOptimize' { 'ExportDialogFlowTests'; break }
    'MainWindow|App' { ''; break }  # å…¨é‡æµ‹è¯•
    default          { 'UiSmokeTests' }
}

# è¿è¡Œæµ‹è¯•
cd tests\DesktopUiTests\DesktopUiTests
if ($testFilter) {
    dotnet test --filter "FullyQualifiedName~$testFilter" --configuration Release -v q
} else {
    dotnet test --configuration Release -v q
}
```

---

## é˜¶æ®µ 3: æäº¤ + CI (æ— ç­‰å¾…ä¼˜åŒ–)

### 3.1 æ™ºèƒ½æäº¤æ¶ˆæ¯
```powershell
git add .
# è‡ªåŠ¨ç”Ÿæˆ: [åŠŸèƒ½ç±»å‹] ç®€è¦æè¿°
git commit -m "[Feature] æ·»åŠ çš„åŠŸèƒ½æè¿°"
git push
```

### 3.2 æ™ºèƒ½ç­‰å¾… (ä¸æ˜¯å›ºå®š 60s)
// turbo
```powershell
# æ ¹æ® CI å†å²å¹³å‡æ—¶é—´åŠ¨æ€ç­‰å¾…
# å°æ”¹åŠ¨: 30s, å¤§æ”¹åŠ¨: 90s, æ–°ä¾èµ–: 120s
$waitTime = switch ($changeSize) {
    'small' { 30 }
    'medium' { 60 }
    'large' { 90 }
    default { 45 }
}
Start-Sleep -Seconds $waitTime
```

---

## é˜¶æ®µ 4: CI çŠ¶æ€æ£€æŸ¥ (æ™ºèƒ½è½®è¯¢)

### 4.1 æ¸è¿›å¼æ£€æŸ¥
```
ç¬¬ 1 æ¬¡: 30s åæ£€æŸ¥
ç¬¬ 2 æ¬¡: +15s åæ£€æŸ¥
ç¬¬ 3 æ¬¡: +15s åæ£€æŸ¥
æœ€å¤šç­‰å¾…: 3 åˆ†é’Ÿ
```

### 4.2 çŠ¶æ€åˆ†æ
ä½¿ç”¨ browser_subagent æ£€æŸ¥ GitHub Actions:
- URL: https://github.com/suyao1992/NetDiagPro/actions
- è§£æ job çŠ¶æ€

---

## é˜¶æ®µ 5: å¤±è´¥è‡ªæ„ˆç³»ç»Ÿ

### 5.1 é”™è¯¯æ¨¡å¼åº“
| é”™è¯¯æ¨¡å¼ | è‡ªåŠ¨ä¿®å¤ç­–ç•¥ |
|---------|-------------|
| `error CS0246: æ‰¾ä¸åˆ°ç±»å‹` | æ·»åŠ  using è¯­å¥ |
| `error CS0103: åç§°ä¸å­˜åœ¨` | æ£€æŸ¥æ‹¼å†™æˆ–æ·»åŠ å¼•ç”¨ |
| `NU1701: åŒ…ä¸å…¼å®¹` | æ›´æ–° TargetFramework |
| `MSB3073: é€€å‡ºä»£ç  1` | æ£€æŸ¥æ„å»ºé…ç½® |
| `Assert.NotNull failed` | æ·»åŠ ç©ºæ£€æŸ¥ |
| `æ‰¾ä¸åˆ° FlaUI` | è¿˜åŸ NuGet åŒ… |

### 5.2 è‡ªåŠ¨ä¿®å¤æµç¨‹
```
é”™è¯¯ â†’ åŒ¹é…æ¨¡å¼ â†’ åº”ç”¨ä¿®å¤ â†’ é‡æ–°éªŒè¯
  â†“
æ— æ³•è‡ªåŠ¨ä¿®å¤ â†’ ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š â†’ é€šçŸ¥ç”¨æˆ·
```

### 5.3 ä¿®å¤å°è¯•é™åˆ¶
- åŒä¸€é”™è¯¯æœ€å¤šå°è¯• 3 æ¬¡
- ä¸åŒé”™è¯¯æœ€å¤šå°è¯• 5 æ¬¡
- è¶…è¿‡é™åˆ¶ â†’ æŠ¥å‘Šç»™ç”¨æˆ·

---

## é˜¶æ®µ 6: å®ŒæˆæŠ¥å‘Š

### æˆåŠŸæŠ¥å‘Š
```
âœ… åŠŸèƒ½å®Œæˆ: [åŠŸèƒ½åç§°]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ä»£ç å˜æ›´: 3 æ–‡ä»¶, +127 / -15 è¡Œ
ğŸ”¨ æœ¬åœ°æ„å»º: é€šè¿‡ (2.3s)
ğŸ§ª UI æµ‹è¯•: 2/2 é€šè¿‡ (8.7s)
ğŸ”„ CI çŠ¶æ€: å…¨ç»¿ âœ…
ğŸ“Š è­¦å‘Šæ•°: 18 (æ— æ–°å¢)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»è€—æ—¶: 2m 15s
```

### å¤±è´¥æŠ¥å‘Š (æ— æ³•è‡ªåŠ¨ä¿®å¤æ—¶)
```
âŒ éœ€è¦äººå·¥ä»‹å…¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
é—®é¢˜ç±»å‹: ç¼–è¯‘é”™è¯¯
é”™è¯¯ä½ç½®: Views/SpeedTestPage.xaml.cs:47
é”™è¯¯ä¿¡æ¯: 'SpeedTestResult' ä¸åŒ…å« 'Latency' çš„å®šä¹‰
å°è¯•æ¬¡æ•°: 3/3
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å»ºè®®: æ£€æŸ¥ Models.cs ä¸­çš„ SpeedTestResult å®šä¹‰
æˆªå›¾: artifacts/error_20251226_041500.png
```

---

## æ€§èƒ½æŒ‡æ ‡ç›®æ ‡

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ |
|------|------|------|
| æœ¬åœ°éªŒè¯ | ~60s | < 20s |
| CI ç­‰å¾… | å›ºå®š 60s | åŠ¨æ€ 30-90s |
| é”™è¯¯ä¿®å¤å‘¨æœŸ | æ‰‹åŠ¨ | < 30s è‡ªåŠ¨ |
| å…¨æµç¨‹ | ~5m | < 3m |

---

## å¿«æ·å‘½ä»¤

### å®Œæ•´éªŒè¯
```powershell
# ä¸€é”®æ‰§è¡Œå…¨æµç¨‹
.\tests\run-full-verify.ps1
```

### ä»…æœ¬åœ°æµ‹è¯•
```powershell
.\tests\run-ui-tests.ps1
```

### ä»… CI æ£€æŸ¥
```powershell
# ä½¿ç”¨ browser_subagent æ£€æŸ¥
```

---

## æŒç»­æ”¹è¿›

### è‡ªåŠ¨æ”¶é›†çš„æŒ‡æ ‡
- æ¯æ¬¡ CI çš„æ„å»ºæ—¶é—´
- æœ€å¸¸è§çš„é”™è¯¯ç±»å‹
- è‡ªåŠ¨ä¿®å¤æˆåŠŸç‡
- å¹³å‡ä¿®å¤æ—¶é—´

### æ¯å‘¨ä¼˜åŒ–
- åˆ†æé”™è¯¯æ¨¡å¼
- æ›´æ–°è‡ªåŠ¨ä¿®å¤è§„åˆ™
- ä¼˜åŒ–æµ‹è¯•é€‰æ‹©é€»è¾‘
